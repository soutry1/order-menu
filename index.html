<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>点菜系统 - 底部弹窗订单</title>
<style>
  body {
    font-family: sans-serif;
    margin: 0;
    padding-bottom: 90px;
    background: #f9f9f9;
  }
  header {
    background-color: #ff6600;
    color: white;
    text-align: center;
    padding: 15px;
    font-size: 20px;
  }
  .menu {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
    padding: 10px;
  }
  .dish {
    background: white;
    width: 45%;
    margin-bottom: 15px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    text-align: center;
    position: relative;
  }
  .dish img {
    width: 100%;
    height: auto;
  }
  .dish h3, .dish p {
    margin: 8px 0;
  }
  .dish button {
    margin: 10px auto;
    width: 90%;
    padding: 10px;
    border: none;
    background-color: #28a745;
    color: white;
    font-weight: bold;
    border-radius: 5px;
    cursor: pointer;
  }
  .badge {
    position: absolute;
    top: 8px;
    left: 8px;
    background-color: red;
    color: white;
    border-radius: 50%;
    padding: 4px 8px;
    font-size: 12px;
    font-weight: bold;
    display: none;
  }

  /* 底部固定栏 */
  .order-summary {
    position: fixed;
    bottom: 0; left: 0; width: 100%;
    background: white;
    box-shadow: 0 -2px 5px rgba(0,0,0,0.2);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 20px;
    box-sizing: border-box;
    z-index: 100;
  }
  .order-summary button {
    background-color: #007bff;
    color: white;
    font-weight: bold;
    border: none;
    border-radius: 5px;
    padding: 10px 20px;
    cursor: pointer;
    user-select: none;
    flex-shrink: 0;
  }
  .order-summary .info {
    font-size: 16px;
    user-select: none;
    text-align: right;
    flex-grow: 1;
    padding-left: 20px;
    cursor: pointer;
  }

  /* 底部弹窗订单 */
  .order-drawer {
    position: fixed;
    bottom: -100%;
    left: 0;
    width: 100%;
    max-height: 60%;
    background: white;
    border-top-left-radius: 15px;
    border-top-right-radius: 15px;
    box-shadow: 0 -3px 15px rgba(0,0,0,0.3);
    overflow-y: auto;
    transition: bottom 0.3s ease;
    z-index: 200;
    padding: 15px 20px 30px;
  }
  .order-drawer.active {
    bottom: 0;
  }
  .order-drawer h3 {
    margin: 0 0 15px 0;
    font-size: 22px;
    text-align: center;
  }
  .order-list {
    list-style: none;
    padding: 0;
    margin: 0 0 20px 0;
  }
  .order-list li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    font-size: 16px;
  }
  .order-list .name {
    flex: 1;
  }
  .order-list .qty-controls {
    display: flex;
    align-items: center;
    margin: 0 15px;
  }
  .order-list button.qty-btn {
    width: 28px;
    height: 28px;
    border: none;
    background: #ddd;
    font-weight: bold;
    font-size: 18px;
    border-radius: 4px;
    cursor: pointer;
    user-select: none;
    line-height: 1;
    text-align: center;
    margin: 0 5px;
    transition: background-color 0.2s;
  }
  .order-list button.qty-btn:hover {
    background: #bbb;
  }
  .order-list .qty {
    min-width: 24px;
    text-align: center;
  }
  .order-list .price {
    min-width: 70px;
    text-align: right;
  }
  .order-total {
    text-align: right;
    font-weight: bold;
    font-size: 18px;
    margin-bottom: 10px;
  }
  .close-drawer {
    display: block;
    width: 100%;
    background: #ccc;
    border: none;
    padding: 10px;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    user-select: none;
  }
  .close-drawer:hover {
    background: #bbb;
  }

  /* 遮罩层 */
  .overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.4);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 199;
  }
  .overlay.active {
    opacity: 1;
    pointer-events: auto;
  }
</style>
</head>
<body>
<header>手机点菜系统</header>

<section class="menu" id="menu"></section>

<div class="order-summary">
  <button id="submit-order-btn">提交订单</button>
  <div class="info" id="order-info">已点 0 样 / 0 份 / ￥0.00</div>
</div>

<!-- 底部弹窗 -->
<div class="order-drawer" id="order-drawer">
  <h3>订单详情</h3>
  <ul class="order-list" id="order-list"></ul>
  <div class="order-total" id="order-total">总价：￥0.00</div>
  <button class="close-drawer" id="close-drawer-btn">关闭</button>
</div>

<!-- 遮罩层 -->
<div class="overlay" id="overlay"></div>

<script>
  const menuData = [
    { id: 1, name: "宫保鸡丁", price: 50 },
    { id: 2, name: "鱼香肉丝", price: 45 },
    { id: 3, name: "麻婆豆腐", price: 40 },
    { id: 4, name: "红烧肉", price: 60 },
    { id: 5, name: "回锅肉", price: 48 },
    { id: 6, name: "西红柿炒蛋", price: 28 },
    { id: 7, name: "蒜蓉空心菜", price: 20 },
    { id: 8, name: "干锅花菜", price: 38 },
    { id: 9, name: "香煎豆腐", price: 32 },
    { id: 10, name: "酸辣土豆丝", price: 25 },
    { id: 11, name: "椒盐排骨", price: 55 },
    { id: 12, name: "糖醋里脊", price: 58 }
  ];

  const order = [];

  const menuEl = document.getElementById('menu');
  const orderInfoEl = document.getElementById('order-info');
  const orderDrawer = document.getElementById('order-drawer');
  const orderListEl = document.getElementById('order-list');
  const orderTotalEl = document.getElementById('order-total');
  const overlay = document.getElementById('overlay');
  const submitOrderBtn = document.getElementById('submit-order-btn');
  const closeDrawerBtn = document.getElementById('close-drawer-btn');

  function renderMenu() {
    menuData.forEach((item, idx) => {
      const dishDiv = document.createElement('div');
      dishDiv.className = 'dish';
      dishDiv.dataset.id = item.id;
      dishDiv.dataset.name = item.name;
      dishDiv.dataset.price = item.price;
      dishDiv.innerHTML = `
        <span class="badge" id="badge-${item.id}">0</span>
        <img src="https://via.placeholder.com/300x200?text=${idx + 1}" alt="${item.name}">
        <h3>${item.name}</h3>
        <p>￥${item.price}</p>
        <button onclick="addDish(${item.id})">点单</button>
      `;
      menuEl.appendChild(dishDiv);
    });
  }

  function addDish(id) {
    let item = order.find(i => i.id === id);
    if(item) {
      item.quantity++;
    } else {
      const menuItem = menuData.find(m => m.id === id);
      order.push({ id: menuItem.id, name: menuItem.name, price: menuItem.price, quantity: 1 });
    }
    updateBadge(id);
    updateOrderInfo();
  }

  function updateBadge(id) {
    const badge = document.getElementById(`badge-${id}`);
    const item = order.find(i => i.id === id);
    if(item && item.quantity > 0) {
      badge.innerText = item.quantity;
      badge.style.display = 'inline-block';
    } else {
      badge.style.display = 'none';
      badge.innerText = '0';
    }
  }

  function updateOrderInfo() {
    const totalCount = order.reduce((sum, i) => sum + i.quantity, 0);
    const typesCount = order.length;
    const totalPrice = order.reduce((sum, i) => sum + i.price * i.quantity, 0);
    orderInfoEl.innerText = `已点 ${typesCount} 样 / ${totalCount} 份 / ￥${totalPrice.toFixed(2)}`;
  }

  function openOrderDrawer() {
    if(order.length === 0) {
      alert('您还没有点菜！');
      return;
    }
    renderOrderList();
    orderDrawer.classList.add('active');
    overlay.classList.add('active');
  }

  function closeOrderDrawer() {
    orderDrawer.classList.remove('active');
    overlay.classList.remove('active');
  }

  function renderOrderList() {
    orderListEl.innerHTML = '';
    order.forEach(item => {
      const li = document.createElement('li');
      li.innerHTML = `
        <div class="name">${item.name}</div>
        <div class="qty-controls">
          <button class="qty-btn" onclick="changeQuantity(${item.id}, -1)">-</button>
          <div class="qty">${item.quantity}</div>
          <button class="qty-btn" onclick="changeQuantity(${item.id}, 1)">+</button>
        </div>
        <div class="price">￥${(item.price * item.quantity).toFixed(2)}</div>
      `;
      orderListEl.appendChild(li);
    });
    const totalPrice = order.reduce((sum, i) => sum + i.price * i.quantity, 0);
    orderTotalEl.innerText = `总价：￥${totalPrice.toFixed(2)}`;
  }

  function changeQuantity(id, delta) {
    const item = order.find(i => i.id === id);
    if(!item) return;

    item.quantity += delta;
    if(item.quantity <= 0) {
      const idx = order.findIndex(i => i.id === id);
      order.splice(idx, 1);
      updateBadge(id);
    } else {
      updateBadge(id);
    }

    updateOrderInfo();
    renderOrderList();

    if(order.length === 0) {
      closeOrderDrawer();
    }
  }

  function submitOrder() {
    if(order.length === 0) {
      alert('您还没有点菜！');
      return;
    }
    let msg = '您点的菜：\n';
    order.forEach(item => {
      msg += `${item.name} x${item.quantity} = ￥${(item.price * item.quantity).toFixed(2)}\n`;
    });
    const totalPrice = order.reduce((sum, i) => sum + i.price * i.quantity, 0);
    msg += `\n总价：￥${totalPrice.toFixed(2)}`;
    alert(msg);

    // 清空订单
    order.length = 0;
    menuData.forEach(item => updateBadge(item.id));
    updateOrderInfo();
    closeOrderDrawer();
  }

  // 事件绑定
  submitOrderBtn.onclick = submitOrder;
  orderInfoEl.onclick = openOrderDrawer;
  closeDrawerBtn.onclick = closeOrderDrawer;
  overlay.onclick = closeOrderDrawer;

  renderMenu();
  updateOrderInfo();

  // 全局暴露，方便html按钮调用
  window.addDish = addDish;
  window.changeQuantity = changeQuantity;
</script>
</body>
</html>
